import L from"bwip-js/browser";function G(i){let h=new Date(i),c=h.getFullYear(),t=String(h.getMonth()+1).padStart(2,"0"),a=String(h.getDate()).padStart(2,"0"),m=String(h.getHours()).padStart(2,"0"),f=String(h.getMinutes()).padStart(2,"0"),n=String(h.getSeconds()).padStart(2,"0");return`${a}-${t}-${c} ${m}:${f}:${n}`}import S from"exceljs";var _=async({columns:i,data:h,grouping:c,date:t,excelSetting:a,title:m})=>{let f=new S.Workbook;i=i.filter(r=>!r.options?.disabledColumn);let n=f.addWorksheet(m||a?.titleExcel),k=i.length,u=n.addRow([]);if(u.getCell(1).value=m||a?.titleExcel,u.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${u.number}:${String.fromCharCode(64+k)}${u.number}`),u.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),t){let r=n.addRow([]);r.getCell(1).value=`Tanggal : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,r.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${r.number}:${String.fromCharCode(64+k)}${r.number}`),r.eachCell(o=>{o.font={color:{argb:"00000"},bold:!0,size:12}})}let R=n.addRow([]);R.getCell(1).value=a?.additionalTextHeader||"",R.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${R.number}:${String.fromCharCode(64+k)}${R.number}`),R.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),n.addRow(i).eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0};let o=r.value;r.value&&(r.alignment={horizontal:`${o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left"}`},r.value=o.label)});let E={};h.forEach(r=>{if(c.length>0){let o=c.map(l=>({value:r[l]!==void 0?`${N(l)} : `+r[l]:""}));n.addRow(o.map(l=>l.value));let y={};r.detail.forEach(l=>{let p=i.map(g=>{let d=g?.options?.format==="DATETIME"?G(l[g.key]):l[g.key],T={horizontal:g?.options?.halign?g?.options?.halign:g?.options?.format==="RP"||g?.options?.format==="GR"?"right":"left"},$=g.key;return E[$]=(E[$]||0)+Number(d),y[$]=(y[$]||0)+Number(d),{value:d,alignment:T,numFmt:g?.options?.format==="RP"?"#,##0":g?.options?.format==="GR"?"#,##0.000":void 0}}),s=n.addRow(p.map(g=>g.value));p.forEach((g,d)=>{let T=s.getCell(d+1);T.alignment=g.alignment,g.numFmt&&(T.numFmt=g.numFmt)})});let e=n.addRow(i.map(()=>null));i.forEach((l,p)=>{if(l?.options?.format==="RP"||l?.options?.format==="GR"){let g=h.length+4-1,d=`SUM(${String.fromCharCode(65+p)}4:${String.fromCharCode(65+p)}${g})`,T=e.getCell(p+1);e.getCell(1).value="SUB TOTAL",e.getCell(1).alignment={horizontal:"center"},T.numFmt=l?.options?.format==="GR"?"#,##0.000":"#,##0",T.value={formula:d},e.getCell(p+1).value=l?.options.disabledFooter?"":y[l.key]}else e.getCell(p+1).value=""}),a?.grandTotalSetting?.colSpan&&n.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},l.font={color:{argb:a?.txtColor},bold:!0}})}else{let o=i.map(e=>{let l=e?.options?.format==="DATETIME"?G(r[e.key]):r[e.key],p={vertical:"middle",horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"?"right":"left"},s=e.key;return E[s]=(E[s]||0)+Number(l),{value:l,options:e?.options,alignment:p,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":e?.options?.barcodeOption!==void 0?"BARCODE":void 0}}),y=n.addRow(o.map(e=>e.value));o.forEach((e,l)=>{let p=y.getCell(l+1),s=e.options?.barcodeOption;if(s!==void 0){let T=document.createElement("canvas");L.toCanvas(T,{bcid:s.format||"code128",text:String(e.value),scale:3,height:10,includetext:s.showText||!0,textxalign:"center"});let $=p.workbook.addImage({base64:T.toDataURL("image/png"),extension:"png"});y.height=s.heightColumn||39;let A=n.getColumn(l+1);return A.width=s.widthColumn||12,n.addImage($,{tl:{col:l+1-1,row:Number(p.row||0)-1},ext:{width:s.widthBarcode||100,height:s.heightBarcode||50}}),p.alignment={horizontal:"center"},p.value="",null}let g=e.alignment.vertical?String(e.alignment.vertical||"bottom"):"bottom",d="";(g==="middle"||g==="bottom"||g==="justify"||g==="distributed"||g==="top")&&(d=g),p.alignment={horizontal:e.alignment.horizontal,vertical:d},e.numFmt&&(p.numFmt=e.numFmt)})}});let b=n.addRow(i.map(()=>null));i.forEach((r,o)=>{if(r?.options?.format==="RP"||r?.options?.format==="GR"){let e=h.length+4-1,l=`SUM(${String.fromCharCode(65+o)}4:${String.fromCharCode(65+o)}${e})`,p=b.getCell(o+1);b.getCell(1).value="GRAND TOTAL",b.getCell(1).alignment={horizontal:"center"},p.numFmt=r?.options?.format==="GR"?"#,##0.000":"#,##0",p.value={formula:l},b.getCell(o+1).value=r?.options.disabledFooter?"":E[r.key]}else b.getCell(o+1).value=""}),a?.grandTotalSetting?.colSpan&&n.mergeCells(`A${b.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${b.number}`),b.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0}});let x=await f.xlsx.writeBuffer(),C=new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=document.createElement("a");w.href=URL.createObjectURL(C),w.download=`${m||a?.titleExcel}.xlsx`,document.body.appendChild(w),w.click(),document.body.removeChild(w)},F=_,N=i=>i.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");import O from"jspdf";import j from"jspdf-autotable";var U=({columns:i,data:h,grouping:c,pdfSetting:t,date:a,title:m})=>{let f=new O(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),n=[],k=a?30:20;i=i.filter(o=>!o.options?.disabledColumn),f.setFontSize(10);let u=f.internal.pageSize.getWidth(),R=f.splitTextToSize(t?.textHeaderLeft||"",110);f.text(R,15,18),f.text(`${m||t?.titlePdf}`,u-15,18,{align:"right"}),a&&f.text(`Tanggal : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,u-15,22,{align:"right"}),f.setProperties({title:m||t?.titlePdf});let P=i.map(o=>({content:o.label,key:o.key,options:o?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left"}}));n.push(P);let E={};h.forEach(o=>{if(c.length>0){let y=c.map(s=>({content:o[s]!==void 0?`${B(s)} : `+o[s]:""}));n.push(y);let e={};o.detail.forEach(s=>{let g=i.map(d=>{let T=s[d.key],$=d.key;return E[$]=(E[$]||0)+Number(T),e[$]=(e[$]||0)+Number(T),{content:(()=>{switch(d?.options?.format){case"RP":return s[d.key]!==void 0?Number(s[d.key]||0).toLocaleString("kr-ko"):"";case"GR":return s[d.key]!==void 0?Number(s[d.key]||0).toFixed(3):"";case"DATETIME":return s[d.key]!==void 0?G(s[d.key]||new Date):"";default:return s[d.key]!==void 0?s[d.key].toString():""}})(),styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||typeof s[d.key]=="number"?"right":"left"}}});n.push(g)});let l=[];i.forEach(s=>{let g=e[s.key];if(s?.options?.format==="RP"||s?.options?.format==="GR"){let d={content:s?.options?.disabledFooter?"":(()=>{switch(s?.options?.format){case"RP":return g.toLocaleString("kr-ko");case"GR":return g.toFixed(3);default:return g.toString()}})(),styles:{halign:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};l.push(d)}else l.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let p=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0;l[0]={content:"SUB TOTAL",colSpan:p,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&l.splice(1,t?.grandTotalSetting?.colSpan),n.push(l)}else{let y=i.map(e=>{let l=o[e.key],p=e.key;return E[p]=(E[p]||0)+Number(l),{options:e?.options,content:(()=>{switch(e?.options?.format){case"RP":return o[e.key]!==void 0?Number(o[e.key]||0).toLocaleString("kr-ko"):"";case"GR":return o[e.key]!==void 0?Number(o[e.key]||0).toFixed(3):"";case"DATETIME":return o[e.key]!==void 0?G(o[e.key]||new Date):"";default:return o[e.key]!==void 0?o[e.key].toString():""}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||typeof o[e.key]=="number"?"right":"left"}}});n.push(y)}});let b=[];i.forEach(o=>{let y=E[o.key];if(o?.options?.format==="RP"||o?.options?.format==="GR"){let e={options:o?.options,content:o?.options?.disabledFooter?"":(()=>{switch(o?.options?.format){case"RP":return y.toLocaleString("kr-ko");case"GR":return y.toFixed(3);default:return y.toString()}})(),styles:{halign:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};b.push(e)}else b.push({content:"",options:o?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let x=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0;t?.grandTotalSetting?.disableGrandTotal||(b[0]={content:"GRAND TOTAL",colSpan:x,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&b.splice(1,t?.grandTotalSetting?.colSpan),n.push(b)),n.push([{content:`Print Date : ${G(`${new Date}`)}`,colSpan:i.length,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),j(f,{head:[],body:n,startY:k,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),n=[],k=f.lastAutoTable.finalY;let C=f.internal.getNumberOfPages(),w=f.internal.pageSize.width,r=f.internal.pageSize.height;f.setFontSize(10);for(let o=1;o<C+1;o++){let y=w/2,e=r-10;f.setPage(o),f.text(`${o} of ${C}`,y,e,{align:"center"})}if(t?.openNewTab){let o=f.output("bloburl");window.open(o)}else f.save(`${m||t?.titlePdf}.pdf`)},B=i=>i.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),I=U;var M=i=>{let h=[];for(let c=0;c<1;c++){let t=i.data.map(a=>{let m=i.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(m);)m=m.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(f,n,k)=>{let u=k.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(a[n])?a[n]:[a[n]]).reduce((E,b)=>E+u.replace(/\{([a-z0-9_]+)\}/gm,x=>{let C=x.replace(/(\{|\})/g,"");if(C.match(/nama_barang/)){let w=C.match(/nama_barang/),r=C==="nama_barang2"?[20,40]:C==="nama_barang3"?[40,60]:[0,20];return b[w]?.slice(...r).trim()||""}if(C.match(/deskripsi_jual/)){let w=C.match(/deskripsi_jual/),r=C==="deskripsi_jual2"?[20,40]:C==="deskripsi_jual3"?[40,60]:[0,20];return b[w]?.slice(...r).trim()||""}if(C.match(/deskripsi/)){let w=C.match(/deskripsi/),r=C==="deskripsi2"?[20,40]:C==="deskripsi3"?[40,60]:[0,20];return b[w]?.slice(...r).trim()||""}return b[C]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return m.replace(/\{([a-z0-9_]+)\}/gm,f=>{let n=f.replace(/(\{|\})/g,"");return n==="intenal_external"?c===0?"Pelanggan":"Internal":n.match(/auto_cut/)?`
VA`:a[n]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail_barang\)/g,"").replace(/[}{]/g,"")});for(let a in t)t[a]+=`

`;h.push(...t)}return h},H=async(i,h)=>{let c=M(i),t=new Blob([c?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=h,document.body.appendChild(a),a.click(),document.body.removeChild(a)},z=H;var lt=({columns:i,data:h,grouping:c,date:t,type:a,txtSetting:m,pdfSetting:f,excelSetting:n,title:k})=>{let u={data:m?.dataTxt?.length?m?.dataTxt:[m?.dataTxt],template:m?.templateTxt};a.forEach(R=>{R==="PDF"?I({pdfSetting:f,date:t,data:h,type:a,columns:i,grouping:c,title:k}):R==="TXT"?z(u,m?.titleTxt||""):R==="EXCEL"?F({date:t,data:h,type:a,columns:i,grouping:c,excelSetting:n,title:k}):(F({date:t,data:h,type:a,columns:i,grouping:c,excelSetting:n,title:k}),I({pdfSetting:f,date:t,data:h,type:a,columns:i,grouping:c,title:k}),z(u,m?.titleTxt||""))})};export{lt as ExportData};
//# sourceMappingURL=index.mjs.map