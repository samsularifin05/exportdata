var z=["EXCEL","PDF","TXT","ALL"];function x(n){let p=new Date(n),b=p.getFullYear(),o=String(p.getMonth()+1).padStart(2,"0"),a=String(p.getDate()).padStart(2,"0"),m=String(p.getHours()).padStart(2,"0"),f=String(p.getMinutes()).padStart(2,"0"),g=String(p.getSeconds()).padStart(2,"0");return`${a}-${o}-${b} ${m}:${f}:${g}`}function M(n){return n.every(p=>z.includes(p))}import B from"exceljs";var _=async({columns:n,data:p,grouping:b,date:o,excelSetting:a,title:m,footerSetting:f})=>{let g=new B.Workbook;n=n.filter(r=>!r.options?.disabledColumn);let i=g.addWorksheet(m||a?.titleExcel),w=n.length,k=i.addRow([]);if(k.getCell(1).value=m||a?.titleExcel,k.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${k.number}:${String.fromCharCode(64+w)}${k.number}`),k.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),o){let r=i.addRow([]);r.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,r.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${r.number}:${String.fromCharCode(64+w)}${r.number}`),r.eachCell(t=>{t.font={color:{argb:"00000"},bold:!0,size:12}})}let G=i.addRow([]);G.getCell(1).value=a?.additionalTextHeader||"",G.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${G.number}:${String.fromCharCode(64+w)}${G.number}`),G.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),i.addRow(n).eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0};let t=r.value;r.value&&(r.alignment={horizontal:`${t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}`},r.value=t.label)});let R={};p.forEach(r=>{if(b.length>0){let t=b.map(l=>({value:r[l]!==void 0?`${S(l)} : `+r[l]:""}));i.addRow(t.map(l=>l.value));let C={};r.detail.forEach(l=>{let h=n.map(c=>{let s=c?.options?.format==="DATETIME"?x(l[c.key]):l[c.key],E={horizontal:c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"?"right":"left"},d=c.key;return R[d]=(R[d]||0)+Number(s),C[d]=(C[d]||0)+Number(s),{value:s,alignment:E,numFmt:c?.options?.format==="RP"?"#,##0":c?.options?.format==="GR"?"#,##0.000":void 0}}),u=i.addRow(h.map(c=>c.value));h.forEach((c,s)=>{let E=u.getCell(s+1);E.alignment=c.alignment,c.numFmt&&(E.numFmt=c.numFmt)})});let e=i.addRow(n.map(()=>null));n.forEach((l,h)=>{if(l?.options?.format==="RP"||l?.options?.format==="GR"||l?.options?.format==="NUMBER"){let c=p.length+4-1,s=`SUM(${String.fromCharCode(65+h)}4:${String.fromCharCode(65+h)}${c})`,E=e.getCell(h+1),d=f?.subTotal?.enableCount&&b.length>0?" : "+r.detail.length:"",F=f?.subTotal?.captionItem?f?.subTotal?.captionItem:"";e.getCell(1).value=`${f?.subTotal?.caption||"SUB TOTAL"} ${d} ${F}`,e.getCell(1).alignment={horizontal:"center"},E.numFmt=l?.options?.format==="GR"?"#,##0.000":"#,##0",E.value={formula:s},e.getCell(h+1).value=l?.options.disabledFooter?"":C[l.key]}else e.getCell(h+1).value=""}),a?.grandTotalSetting?.colSpan&&i.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},l.font={color:{argb:a?.txtColor},bold:!0}})}else{let t=n.map(e=>{let l=e?.options?.format==="DATETIME"?x(r[e.key]):r[e.key],h={vertical:"middle",horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left"},u=e.key;return R[u]=(R[u]||0)+Number(l),{value:l,options:e?.options,alignment:h,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),C=i.addRow(t.map(e=>e.value));t.forEach((e,l)=>{let h=C.getCell(l+1),u=e.alignment.vertical?String(e.alignment.vertical||"bottom"):"bottom",c="";(u==="middle"||u==="bottom"||u==="justify"||u==="distributed"||u==="top")&&(c=u),h.alignment={horizontal:e.alignment.horizontal,vertical:c},e.numFmt&&(h.numFmt=e.numFmt)})}});let y=i.addRow(n.map(()=>null));n.forEach((r,t)=>{if(r?.options?.format==="RP"||r?.options?.format==="GR"||r?.options?.format==="NUMBER"){let e=p.length+4-1,l=`SUM(${String.fromCharCode(65+t)}4:${String.fromCharCode(65+t)}${e})`,h=y.getCell(t+1),u=f?.grandTotal?.enableCount?b.length>0?" : "+p.map(E=>E.detail.length).reduce((E,d)=>E+d,0):" : "+p.length:"",c=f?.grandTotal?.captionItem?f?.grandTotal?.captionItem:"",s=`${f?.grandTotal?.caption||"GRAND TOTAL"} ${u} ${c}`;y.getCell(1).value=s,y.getCell(1).alignment={horizontal:"center"},h.numFmt=r?.options?.format==="GR"?"#,##0.000":"#,##0",h.value={formula:l},y.getCell(t+1).value=r?.options.disabledFooter?"":R[r.key]}else y.getCell(t+1).value=""}),a?.grandTotalSetting?.colSpan&&i.mergeCells(`A${y.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${y.number}`),y.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0}});let D=await g.xlsx.writeBuffer(),T=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),$=document.createElement("a");$.href=URL.createObjectURL(T),$.download=`${m||a?.titleExcel}.xlsx`,document.body.appendChild($),$.click(),document.body.removeChild($)},L=_,S=n=>n.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");import j from"jspdf";import O from"jspdf-autotable";var H=({columns:n,data:p,grouping:b,pdfSetting:o,date:a,title:m,footerSetting:f})=>{let g=new j(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),i=[],w=a?30:20;n=n.filter(t=>!t.options?.disabledColumn),g.setFontSize(10);let k=g.internal.pageSize.getWidth(),G=g.splitTextToSize(o?.textHeaderLeft||"",110);g.text(G,15,18),g.text(`${m||o?.titlePdf}`,k-15,18,{align:"right"}),a&&g.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,k-15,22,{align:"right"}),g.setProperties({title:m||o?.titlePdf});let N=n.map(t=>({content:t.label,key:t.key,options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}}));i.push(N);let R={};p.forEach(t=>{if(b.length>0){let C=b.map(s=>({content:t[s]!==void 0?`${X(s)} : `+t[s]:""}));i.push(C);let e={};t.detail.forEach(s=>{let E=n.map(d=>{let F=s[d.key],I=d.key;return R[I]=(R[I]||0)+Number(F),e[I]=(e[I]||0)+Number(F),{content:(()=>{switch(d?.options?.format){case"RP":return s[d.key]!==void 0?Number(s[d.key]||0).toLocaleString("kr-ko"):"";case"GR":return s[d.key]!==void 0?Number(s[d.key]||0).toFixed(3):"";case"NUMBER":return s[d.key]!==void 0?Number(s[d.key]||0):"";case"DATETIME":return s[d.key]!==void 0?x(s[d.key]||new Date):"";default:return s[d.key]!==void 0?s[d.key].toString():""}})(),styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"||typeof s[d.key]=="number"?"right":"left"}}});i.push(E)});let l=[];n.forEach(s=>{let E=e[s.key];if(s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"){let d={content:s?.options?.disabledFooter?"":(()=>{switch(s?.options?.format){case"RP":return E.toLocaleString("kr-ko");case"GR":return E.toFixed(3);case"NUMBER":return E;default:return E.toString()}})(),styles:{halign:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};l.push(d)}else l.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let h=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,u=f?.subTotal?.enableCount&&b.length>0?" : "+t.detail.length:"",c=f?.subTotal?.captionItem?f?.subTotal?.captionItem:"";l[0]={content:`${f?.subTotal?.caption||"SUB TOTAL"} ${u} ${c}`,colSpan:h,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&l.splice(1,o?.grandTotalSetting?.colSpan),i.push(l)}else{let C=n.map(e=>{let l=t[e.key],h=e.key;return R[h]=(R[h]||0)+Number(l),{options:e?.options,content:(()=>{switch(e?.options?.format){case"RP":return t[e.key]!==void 0?Number(t[e.key]||0).toLocaleString("kr-ko"):"";case"GR":return t[e.key]!==void 0?Number(t[e.key]||0).toFixed(3):"";case"NUMBER":return t[e.key]!==void 0?Number(t[e.key]||0):"";case"DATETIME":return t[e.key]!==void 0?x(t[e.key]||new Date):"";default:return t[e.key]!==void 0?t[e.key].toString():""}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"||typeof t[e.key]=="number"?"right":"left"}}});i.push(C)}});let y=[];n.forEach(t=>{let C=R[t.key];if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let e={options:t?.options,content:t?.options?.disabledFooter?"":(()=>{switch(t?.options?.format){case"RP":return C.toLocaleString("kr-ko");case"GR":return C.toFixed(3);case"NUMBER":return C;default:return C.toString()}})(),styles:{halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};y.push(e)}else y.push({content:"",options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let D=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0;if(!o?.grandTotalSetting?.disableGrandTotal){let t=f?.grandTotal?.enableCount?b.length>0?" : "+p.map(e=>e.detail.length).reduce((e,l)=>e+l,0):" : "+p.length:"",C=f?.grandTotal?.captionItem?f?.grandTotal?.captionItem:"";y[0]={content:`${f?.grandTotal?.caption||"GRAND TOTAL"} ${t} ${C}`,colSpan:D,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&y.splice(1,o?.grandTotalSetting?.colSpan),i.push(y)}i.push([{content:`Print Date : ${x(`${new Date}`)}`,colSpan:n.length,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),O(g,{head:[],body:i,startY:w,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),i=[],w=g.lastAutoTable.finalY;let T=g.internal.getNumberOfPages(),$=g.internal.pageSize.width,r=g.internal.pageSize.height;g.setFontSize(10);for(let t=1;t<T+1;t++){let C=$/2,e=r-10;g.setPage(t),g.text(`${t} of ${T}`,C,e,{align:"center"})}if(o?.openNewTab){let t=g.output("bloburl");window.open(t)}else g.save(`${m||o?.titlePdf}.pdf`)},X=n=>n.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "),A=H;var K=n=>{let p=[],b=n.copy?2:1;for(let o=0;o<b;o++){let a=n.data.map(m=>{let f=n.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(f);)f=f.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,i,w)=>{let k=w.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(m[i])?m[i]:[m[i]]).reduce((R,y)=>R+k.replace(/\{([a-z0-9_]+)\}/gm,D=>{let T=D.replace(/(\{|\})/g,"");if(T.match(/nama_barang/)){let $=T.match(/nama_barang/),r=T==="nama_barang2"?[20,40]:T==="nama_barang3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}if(T.match(/deskripsi_jual/)){let $=T.match(/deskripsi_jual/),r=T==="deskripsi_jual2"?[20,40]:T==="deskripsi_jual3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}if(T.match(/deskripsi/)){let $=T.match(/deskripsi/),r=T==="deskripsi2"?[20,40]:T==="deskripsi3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}return y[T]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return f.replace(/\{([a-z0-9_]+)\}/gm,g=>{let i=g.replace(/(\{|\})/g,"");return i.match(/auto_cut/)?`
VA`:m[i]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let m in a)a[m]+=`

`;p.push(...a)}return p},W=async(n,p)=>{let b=K(n),o=new Blob([b?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=p,document.body.appendChild(a),a.click(),document.body.removeChild(a)},U=W;var mt=({columns:n,data:p,grouping:b,date:o,type:a,txtSetting:m,pdfSetting:f,excelSetting:g,title:i,footerSetting:w})=>{let k={data:[m?.dataTxt],template:m?.templateTxt,copy:m?.copy};if(p.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!M(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(G=>{G==="PDF"?A({pdfSetting:f,date:o,data:p,type:a,columns:n,grouping:b,title:i,footerSetting:w}):G==="TXT"?U(k,m?.titleTxt||""):G==="EXCEL"?L({date:o,data:p,type:a,columns:n,grouping:b,excelSetting:g,title:i,footerSetting:w}):(L({date:o,data:p,type:a,columns:n,grouping:b,excelSetting:g,title:i}),A({pdfSetting:f,date:o,data:p,type:a,columns:n,grouping:b,title:i}),U(k,m?.titleTxt||""))})};export{mt as ExportData};
//# sourceMappingURL=index.mjs.map