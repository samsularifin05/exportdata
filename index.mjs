var U=["EXCEL","PDF","TXT","ALL"];function x(n){let p=new Date(n),c=p.getFullYear(),o=String(p.getMonth()+1).padStart(2,"0"),a=String(p.getDate()).padStart(2,"0"),b=String(p.getHours()).padStart(2,"0"),g=String(p.getMinutes()).padStart(2,"0"),f=String(p.getSeconds()).padStart(2,"0");return`${a}-${o}-${c} ${b}:${g}:${f}`}function M(n){return n.every(p=>U.includes(p))}import _ from"exceljs";var j=async({columns:n,data:p,grouping:c,date:o,excelSetting:a,title:b,footerSetting:g})=>{let f=new _.Workbook;n=n.filter(r=>!r.options?.disabledColumn);let s=f.addWorksheet(b||a?.titleExcel),k=n.length,R=s.addRow([]);if(R.getCell(1).value=b||a?.titleExcel,R.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${R.number}:${String.fromCharCode(64+k)}${R.number}`),R.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),o){let r=s.addRow([]);r.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,r.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${r.number}:${String.fromCharCode(64+k)}${r.number}`),r.eachCell(t=>{t.font={color:{argb:"00000"},bold:!0,size:12}})}let w=s.addRow([]);w.getCell(1).value=a?.additionalTextHeader||"",w.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${w.number}:${String.fromCharCode(64+k)}${w.number}`),w.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),s.addRow(n).eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0};let t=r.value;r.value&&(r.alignment={horizontal:`${t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}`},r.value=t.label)});let $={};p.forEach(r=>{if(c.length>0){let t=c.map(l=>({value:r[l]!==void 0?`${S(l)} : `+r[l]:""}));s.addRow(t.map(l=>l.value));let C={};r.detail.forEach(l=>{let h=n.map(m=>{let i=m?.options?.format==="DATETIME"?x(l[m.key]):l[m.key],T={horizontal:m?.options?.halign?m?.options?.halign:m?.options?.format==="RP"||m?.options?.format==="GR"||m?.options?.format==="NUMBER"?"right":"left"},d=m.key;return $[d]=($[d]||0)+Number(i),C[d]=(C[d]||0)+Number(i),{value:i,alignment:T,numFmt:m?.options?.format==="RP"?"#,##0":m?.options?.format==="GR"?"#,##0.000":void 0}}),E=s.addRow(h.map(m=>m.value));h.forEach((m,i)=>{let T=E.getCell(i+1);T.alignment=m.alignment,m.numFmt&&(T.numFmt=m.numFmt)})});let e=s.addRow(n.map(()=>null));n.forEach((l,h)=>{if(l?.options?.format==="RP"||l?.options?.format==="GR"||l?.options?.format==="NUMBER"){let m=p.length+4-1,i=`SUM(${String.fromCharCode(65+h)}4:${String.fromCharCode(65+h)}${m})`,T=e.getCell(h+1),d=g?.subTotal?.enableCount&&c.length>0?" : "+r.detail.length:"",v=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";e.getCell(1).value=`${g?.subTotal?.caption||"SUB TOTAL"} ${d} ${v}`,e.getCell(1).alignment={horizontal:"center"},T.numFmt=l?.options?.format==="GR"?"#,##0.000":"#,##0",T.value={formula:i},e.getCell(h+1).value=l?.options.disabledFooter?"":C[l.key]}else e.getCell(h+1).value=""}),a?.grandTotalSetting?.colSpan&&s.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},l.font={color:{argb:a?.txtColor},bold:!0}})}else{let t=n.map(e=>{let l=e?.options?.format==="DATETIME"?x(r[e.key]):r[e.key],h={vertical:"middle",horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left"},E=e.key;return $[E]=($[E]||0)+Number(l),{value:l,options:e?.options,alignment:h,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),C=s.addRow(t.map(e=>e.value));t.forEach((e,l)=>{let h=C.getCell(l+1),E=e.alignment.vertical?String(e.alignment.vertical||"bottom"):"bottom",m="";(E==="middle"||E==="bottom"||E==="justify"||E==="distributed"||E==="top")&&(m=E),h.alignment={horizontal:e.alignment.horizontal,vertical:m},e.numFmt&&(h.numFmt=e.numFmt)})}});let y=s.addRow(n.map(()=>null));n.forEach((r,t)=>{if(r?.options?.format==="RP"||r?.options?.format==="GR"||r?.options?.format==="NUMBER"){let e=p.length+4-1,l=`SUM(${String.fromCharCode(65+t)}4:${String.fromCharCode(65+t)}${e})`,h=y.getCell(t+1),E=g?.grandTotal?.enableCount?c.length>0?" : "+p.map(T=>T.detail.length).reduce((T,d)=>T+d,0):" : "+p.length:"",m=g?.grandTotal?.captionItem?g?.grandTotal?.captionItem:"",i=`${g?.grandTotal?.caption||"GRAND TOTAL"} ${E} ${m}`;y.getCell(1).value=i,y.getCell(1).alignment={horizontal:"center"},h.numFmt=r?.options?.format==="GR"?"#,##0.000":"#,##0",h.value={formula:l},y.getCell(t+1).value=r?.options.disabledFooter?"":$[r.key]}else y.getCell(t+1).value=""}),a?.grandTotalSetting?.colSpan&&s.mergeCells(`A${y.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${y.number}`),y.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0}}),a?.customize&&a.customize(s);let D=await f.xlsx.writeBuffer(),u=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=document.createElement("a");G.href=URL.createObjectURL(u),G.download=`${b||a?.titleExcel}.xlsx`,document.body.appendChild(G),G.click(),document.body.removeChild(G)},L=j,S=n=>n.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");import O from"jspdf";import B from"jspdf-autotable";var H=({columns:n,data:p,grouping:c,pdfSetting:o,date:a,title:b,footerSetting:g})=>{let f=new O(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),s=[],k=a?30:20;n=n.filter(t=>!t.options?.disabledColumn),f.setFontSize(10);let R=f.internal.pageSize.getWidth(),w=f.splitTextToSize(o?.textHeaderLeft||"",110);f.text(w,15,18),f.text(`${b||o?.titlePdf}`,R-15,18,{align:"right"}),a&&f.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,R-15,22,{align:"right"}),f.setProperties({title:b||o?.titlePdf}),o?.finalY&&(k=o.finalY);let N=n.map(t=>({content:t.label,key:t.key,options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}}));s.push(N);let $={};p.forEach(t=>{if(c.length>0){let C=c.map(i=>({content:t[i]!==void 0?`${X(i)} : `+t[i]:""}));s.push(C);let e={};t.detail.forEach(i=>{let T=n.map(d=>{let v=i[d.key],I=d.key;return $[I]=($[I]||0)+Number(v),e[I]=(e[I]||0)+Number(v),{content:(()=>{switch(d?.options?.format){case"RP":return i[d.key]!==void 0?Number(i[d.key]||0).toLocaleString("kr-ko"):"";case"GR":return i[d.key]!==void 0?Number(i[d.key]||0).toFixed(3):"";case"NUMBER":return i[d.key]!==void 0?Number(i[d.key]||0):"";case"DATETIME":return i[d.key]!==void 0?x(i[d.key]||new Date):"";default:return i[d.key]!==void 0?i[d.key].toString():""}})(),styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||d?.options?.format==="NUMBER"||typeof i[d.key]=="number"?"right":"left"}}});s.push(T)});let l=[];n.forEach(i=>{let T=e[i.key];if(i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"){let d={content:i?.options?.disabledFooter?"":(()=>{switch(i?.options?.format){case"RP":return T.toLocaleString("kr-ko");case"GR":return T.toFixed(3);case"NUMBER":return T;default:return T.toString()}})(),styles:{halign:i?.options?.halign?i?.options?.halign:i?.options?.format==="RP"||i?.options?.format==="GR"||i?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};l.push(d)}else l.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let h=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,E=g?.subTotal?.enableCount&&c.length>0?" : "+t.detail.length:"",m=g?.subTotal?.captionItem?g?.subTotal?.captionItem:"";l[0]={content:`${g?.subTotal?.caption||"SUB TOTAL"} ${E} ${m}`,colSpan:h,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&l.splice(1,o?.grandTotalSetting?.colSpan),s.push(l)}else{let C=n.map(e=>{let l=t[e.key],h=e.key;return $[h]=($[h]||0)+Number(l),{options:e?.options,content:(()=>{switch(e?.options?.format){case"RP":return t[e.key]!==void 0?Number(t[e.key]||0).toLocaleString("kr-ko"):"";case"GR":return t[e.key]!==void 0?Number(t[e.key]||0).toFixed(3):"";case"NUMBER":return t[e.key]!==void 0?Number(t[e.key]||0):"";case"DATETIME":return t[e.key]!==void 0?x(t[e.key]||new Date):"";default:return t[e.key]!==void 0?t[e.key].toString():""}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"||typeof t[e.key]=="number"?"right":"left"}}});s.push(C)}});let y=[];n.forEach(t=>{let C=$[t.key];if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let e={options:t?.options,content:t?.options?.disabledFooter?"":(()=>{switch(t?.options?.format){case"RP":return C.toLocaleString("kr-ko");case"GR":return C.toFixed(3);case"NUMBER":return C;default:return C.toString()}})(),styles:{halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};y.push(e)}else y.push({content:"",options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let D=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0;if(!o?.grandTotalSetting?.disableGrandTotal){let t=g?.grandTotal?.enableCount?c.length>0?" : "+p.map(e=>e.detail.length).reduce((e,l)=>e+l,0):" : "+p.length:"",C=g?.grandTotal?.captionItem?g?.grandTotal?.captionItem:"";y[0]={content:`${g?.grandTotal?.caption||"GRAND TOTAL"} ${t} ${C}`,colSpan:D,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&y.splice(1,o?.grandTotalSetting?.colSpan),s.push(y)}s.push([{content:`Print Date : ${x(`${new Date}`)}`,colSpan:n.length,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),B(f,{head:[],body:s,startY:k,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),s=[],k=f.lastAutoTable.finalY;let u=f.internal.getNumberOfPages(),G=f.internal.pageSize.width,r=f.internal.pageSize.height;f.setFontSize(10);for(let t=1;t<u+1;t++){let C=G/2,e=r-10;f.setPage(t),f.text(`${t} of ${u}`,C,e,{align:"center"})}if(typeof o?.customize=="function"&&o.customize(f,k,B),o?.openNewTab){let t=f.output("bloburl");window.open(t)}else f.save(`${b||o?.titlePdf}.pdf`)},X=n=>n.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "),z=H;var Y=n=>{let p=[],c=n.copy?2:1;for(let o=0;o<c;o++){let a=n.data.map(b=>{let g=n.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(g);)g=g.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(f,s,k)=>{let R=k.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(b[s])?b[s]:[b[s]]).reduce(($,y)=>$+R.replace(/\{([a-z0-9_]+)\}/gm,D=>{let u=D.replace(/(\{|\})/g,"");if(u.match(/nama_barang/)){let G=u.match(/nama_barang/),r=u==="nama_barang2"?[20,40]:u==="nama_barang3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}if(u.match(/deskripsi_jual/)){let G=u.match(/deskripsi_jual/),r=u==="deskripsi_jual2"?[20,40]:u==="deskripsi_jual3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}if(u.match(/deskripsi/)){let G=u.match(/deskripsi/),r=u==="deskripsi2"?[20,40]:u==="deskripsi3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}return y[u]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return g.replace(/\{([a-z0-9_]+)\}/gm,f=>{let s=f.replace(/(\{|\})/g,"");return s.match(/auto_cut/)?`
VA`:b[s]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let b in a)a[b]+=`

`;p.push(...a)}return p},W=async(n,p)=>{let c=Y(n),o=new Blob([c?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=p,document.body.appendChild(a),a.click(),document.body.removeChild(a)},A=W;var bt=({columns:n,data:p,grouping:c,date:o,type:a,txtSetting:b,pdfSetting:g,excelSetting:f,title:s,footerSetting:k})=>{let R={data:[b?.dataTxt],template:b?.templateTxt,copy:b?.copy};if(p.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!M(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(w=>{w==="PDF"?z({pdfSetting:g,date:o,data:p,type:a,columns:n,grouping:c,title:s,footerSetting:k}):w==="TXT"?A(R,b?.titleTxt||""):w==="EXCEL"?L({date:o,data:p,type:a,columns:n,grouping:c,excelSetting:f,title:s,footerSetting:k}):(L({date:o,data:p,type:a,columns:n,grouping:c,excelSetting:f,title:s}),z({pdfSetting:g,date:o,data:p,type:a,columns:n,grouping:c,title:s}),A(R,b?.titleTxt||""))})};export{bt as ExportData};
//# sourceMappingURL=index.mjs.map