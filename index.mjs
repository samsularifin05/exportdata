var U=["EXCEL","PDF","TXT","ALL"];function F(i){let d=new Date(i),m=d.getFullYear(),o=String(d.getMonth()+1).padStart(2,"0"),a=String(d.getDate()).padStart(2,"0"),b=String(d.getHours()).padStart(2,"0"),c=String(d.getMinutes()).padStart(2,"0"),g=String(d.getSeconds()).padStart(2,"0");return`${a}-${o}-${m} ${b}:${c}:${g}`}function M(i){return i.every(d=>U.includes(d))}import _ from"exceljs";var j=async({columns:i,data:d,grouping:m,date:o,excelSetting:a,title:b,footerSetting:c})=>{let g=new _.Workbook;i=i.filter(t=>!t.options?.disabledColumn);let n=g.addWorksheet(b||a?.titleExcel),$=i.length,E=n.addRow([]);E.getCell(1).value=b||a?.titleExcel,E.getCell(1).alignment={horizontal:"center"};let w=n.getColumn($).letter;if(n.mergeCells(`A${E.number}:${w}${E.number}`),E.eachCell(t=>{t.font={color:{argb:"000000"},bold:!0,size:12}}),o){let t=n.addRow([]);t.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,t.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${t.number}:${w}${t.number}`),t.eachCell(p=>{p.font={color:{argb:"00000"},bold:!0,size:12}})}let D=n.addRow([]);D.getCell(1).value=a?.additionalTextHeader||"",D.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${D.number}:${w}${D.number}`),D.eachCell(t=>{t.font={color:{argb:"000000"},bold:!0,size:12}}),n.addRow(i).eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},t.font={color:{argb:a?.txtColor},bold:!0};let p=t.value;t.value&&(t.alignment={horizontal:`${p?.options?.halign?p?.options?.halign:p?.options?.format==="RP"||p?.options?.format==="GR"||p?.options?.format==="NUMBER"?"right":"left"}`},t.value=p.label)});let C={};d.forEach(t=>{if(m.length>0){let p=m.map(f=>({value:t[f]!==void 0?`${O(f)} : `+t[f]:""}));n.addRow(p.map(f=>f.value));let s={};t.detail.forEach(f=>{let h=i.map(e=>{let T=e?.options?.format==="DATETIME"?F(f[e.key]):f[e.key],l={horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left"},G=e.key;return C[G]=(C[G]||0)+Number(T),s[G]=(s[G]||0)+Number(T),{value:T,alignment:l,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),u=n.addRow(h.map(e=>e.value));h.forEach((e,T)=>{let l=u.getCell(T+1);l.alignment=e.alignment,e.numFmt&&(l.numFmt=e.numFmt)})});let r=n.addRow(i.map(()=>null));i.forEach((f,h)=>{if(f?.options?.format==="RP"||f?.options?.format==="GR"||f?.options?.format==="NUMBER"){let e=d.length+4-1,T=`SUM(${String.fromCharCode(65+h)}4:${String.fromCharCode(65+h)}${e})`,l=r.getCell(h+1),G=c?.subTotal?.enableCount&&m.length>0?" : "+t.detail.length:"",v=c?.subTotal?.captionItem?c?.subTotal?.captionItem:"";r.getCell(1).value=`${c?.subTotal?.caption||"SUB TOTAL"} ${G} ${v}`,r.getCell(1).alignment={horizontal:"center"},l.numFmt=f?.options?.format==="GR"?"#,##0.000":"#,##0",l.value={formula:T},r.getCell(h+1).value=f?.options.disabledFooter?"":s[f.key]}else r.getCell(h+1).value=""}),a?.grandTotalSetting?.colSpan&&n.mergeCells(`A${r.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${r.number}`),r.eachCell(f=>{f.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},f.font={color:{argb:a?.txtColor},bold:!0}})}else{let p=i.map(r=>{let f=r?.options?.format==="DATETIME"?F(t[r.key]):t[r.key],h={vertical:"middle",horizontal:r?.options?.halign?r?.options?.halign:r?.options?.format==="RP"||r?.options?.format==="GR"||r?.options?.format==="NUMBER"?"right":"left"},u=r.key;return C[u]=(C[u]||0)+Number(f),{value:f,options:r?.options,alignment:h,numFmt:r?.options?.format==="RP"?"#,##0":r?.options?.format==="GR"?"#,##0.000":void 0}}),s=n.addRow(p.map(r=>r.value));p.forEach((r,f)=>{let h=s.getCell(f+1),u=r.alignment.vertical?String(r.alignment.vertical||"bottom"):"bottom",e="";(u==="middle"||u==="bottom"||u==="justify"||u==="distributed"||u==="top")&&(e=u),h.alignment={horizontal:r.alignment.horizontal,vertical:e},r.numFmt&&(h.numFmt=r.numFmt)})}});let R=n.addRow(i.map(()=>null));i.forEach((t,p)=>{if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let r=d.length+4-1,f=`SUM(${String.fromCharCode(65+p)}4:${String.fromCharCode(65+p)}${r})`,h=R.getCell(p+1),u=c?.grandTotal?.enableCount?m.length>0?" : "+d.map(l=>l.detail.length).reduce((l,G)=>l+G,0):" : "+d.length:"",e=c?.grandTotal?.captionItem?c?.grandTotal?.captionItem:"",T=`${c?.grandTotal?.caption||"GRAND TOTAL"} ${u} ${e}`;R.getCell(1).value=T,R.getCell(1).alignment={horizontal:"center"},h.numFmt=t?.options?.format==="GR"?"#,##0.000":"#,##0",h.value={formula:f},R.getCell(p+1).value=t?.options.disabledFooter?"":C[t.key]}else R.getCell(p+1).value=""}),a?.grandTotalSetting?.colSpan&&n.mergeCells(`A${R.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${R.number}`),R.eachCell(t=>{t.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},t.font={color:{argb:a?.txtColor},bold:!0}}),a?.customize&&a.customize(n);let y=await g.xlsx.writeBuffer(),x=new Blob([y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=document.createElement("a");k.href=URL.createObjectURL(x),k.download=`${a?.titleExcel||b}.xlsx`,document.body.appendChild(k),k.click(),document.body.removeChild(k)},L=j,O=i=>i.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");import S from"jspdf";import B from"jspdf-autotable";var H=({columns:i,data:d,grouping:m,pdfSetting:o,date:a,title:b,footerSetting:c})=>{let g=new S(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),n=[],$=a?30:20;i=i.filter(t=>!t.options?.disabledColumn),g.setFontSize(10);let E=g.internal.pageSize.getWidth(),w=g.splitTextToSize(o?.textHeaderLeft||"",110);g.text(w,15,18),g.text(`${b||o?.titlePdf}`,E-15,18,{align:"right"}),a&&g.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,E-15,22,{align:"right"}),g.setProperties({title:b||o?.titlePdf}),o?.finalY&&(console.log(o.finalY),$=o.finalY);let D=i.map(t=>({content:t.label,key:t.key,options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}}));n.push(D);let P={};d.forEach(t=>{if(m.length>0){let p=m.map(e=>({content:t[e]!==void 0?`${X(e)} : `+t[e]:""}));n.push(p);let s={};t.detail.forEach(e=>{let T=i.map(l=>{let G=e[l.key],v=l.key;return P[v]=(P[v]||0)+Number(G),s[v]=(s[v]||0)+Number(G),{content:(()=>{switch(l?.options?.format){case"RP":return e[l.key]!==void 0?Number(e[l.key]||0).toLocaleString("kr-ko"):"";case"GR":return e[l.key]!==void 0?Number(e[l.key]||0).toFixed(3):"";case"NUMBER":return e[l.key]!==void 0?Number(e[l.key]||0):"";case"DATETIME":return e[l.key]!==void 0?F(e[l.key]||new Date):"";default:return e[l.key]!==void 0?e[l.key].toString():""}})(),styles:{halign:l?.options?.halign?l?.options?.halign:l?.options?.format==="RP"||l?.options?.format==="GR"||l?.options?.format==="NUMBER"||typeof e[l.key]=="number"?"right":"left"}}});n.push(T)});let r=[];i.forEach(e=>{let T=s[e.key];if(e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"){let l={content:e?.options?.disabledFooter?"":(()=>{switch(e?.options?.format){case"RP":return T.toLocaleString("kr-ko");case"GR":return T.toFixed(3);case"NUMBER":return T;default:return T.toString()}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};r.push(l)}else r.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let f=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,h=c?.subTotal?.enableCount&&m.length>0?" : "+t.detail.length:"",u=c?.subTotal?.captionItem?c?.subTotal?.captionItem:"";r[0]={content:`${c?.subTotal?.caption||"SUB TOTAL"} ${h} ${u}`,colSpan:f,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&r.splice(1,o?.grandTotalSetting?.colSpan),n.push(r)}else{let p=i.map(s=>{let r=t[s.key],f=s.key;return P[f]=(P[f]||0)+Number(r),{options:s?.options,content:(()=>{switch(s?.options?.format){case"RP":return t[s.key]!==void 0?Number(t[s.key]||0).toLocaleString("kr-ko"):"";case"GR":return t[s.key]!==void 0?Number(t[s.key]||0).toFixed(3):"";case"NUMBER":return t[s.key]!==void 0?Number(t[s.key]||0):"";case"DATETIME":return t[s.key]!==void 0?F(t[s.key]||new Date):"";default:return t[s.key]!==void 0?t[s.key]?.toString():""}})(),styles:{halign:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"||s?.options?.format==="NUMBER"||typeof t[s.key]=="number"?"right":"left"}}});n.push(p)}});let C=[];i.forEach(t=>{let p=P[t.key];if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let s={options:t?.options,content:t?.options?.disabledFooter?"":(()=>{switch(t?.options?.format){case"RP":return p.toLocaleString("kr-ko");case"GR":return p.toFixed(3);case"NUMBER":return p;default:return p.toString()}})(),styles:{halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};C.push(s)}else C.push({content:"",options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let R=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0;if(!o?.grandTotalSetting?.disableGrandTotal){let t=c?.grandTotal?.enableCount?m.length>0?" : "+d.map(s=>s.detail.length).reduce((s,r)=>s+r,0):" : "+d.length:"",p=c?.grandTotal?.captionItem?c?.grandTotal?.captionItem:"";C[0]={content:`${c?.grandTotal?.caption||"GRAND TOTAL"} ${t} ${p}`,colSpan:R,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&C.splice(1,o?.grandTotalSetting?.colSpan),n.push(C)}typeof o?.addRow=="function"&&o?.addRow(n),n.push([{content:`Print Date : ${F(`${new Date}`)}`,colSpan:i.length,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),B(g,{head:[],body:n,startY:$,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),n=[],$=g.lastAutoTable.finalY;let y=g.internal.getNumberOfPages(),x=g.internal.pageSize.width,k=g.internal.pageSize.height;g.setFontSize(10);for(let t=1;t<y+1;t++){let p=x/2,s=k-10;g.setPage(t),g.text(`${t} of ${y}`,p,s,{align:"center"})}if(typeof o?.customize=="function"&&o.customize(g,$,B),o?.openNewTab){let t=g.output("bloburl");window.open(t)}else g.save(`${o?.titlePdf||b}.pdf`)},X=i=>i.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "),z=H;var Y=i=>{let d=[],m=i.copy?2:1;for(let o=0;o<m;o++){let a=i.data.map(b=>{let c=i.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(c);)c=c.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,n,$)=>{let E=$.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(b[n])?b[n]:[b[n]]).reduce((P,C)=>P+E.replace(/\{([a-z0-9_]+)\}/gm,R=>{let y=R.replace(/(\{|\})/g,"");if(y.match(/nama_barang/)){let x=y.match(/nama_barang/),k=y==="nama_barang2"?[20,40]:y==="nama_barang3"?[40,60]:[0,20];return C[x]?.slice(...k).trim()||""}if(y.match(/deskripsi_jual/)){let x=y.match(/deskripsi_jual/),k=y==="deskripsi_jual2"?[20,40]:y==="deskripsi_jual3"?[40,60]:[0,20];return C[x]?.slice(...k).trim()||""}if(y.match(/deskripsi/)){let x=y.match(/deskripsi/),k=y==="deskripsi2"?[20,40]:y==="deskripsi3"?[40,60]:[0,20];return C[x]?.slice(...k).trim()||""}return C[y]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return c.replace(/\{([a-z0-9_]+)\}/gm,g=>{let n=g.replace(/(\{|\})/g,"");return n.match(/auto_cut/)?`
VA`:b[n]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let b in a)a[b]+=`

`;d.push(...a)}return d},W=async(i,d)=>{let m=Y(i),o=new Blob([m?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=d,document.body.appendChild(a),a.click(),document.body.removeChild(a)},A=W;var bt=({columns:i,data:d,grouping:m,date:o,type:a,txtSetting:b,pdfSetting:c,excelSetting:g,title:n,footerSetting:$})=>{let E={data:[b?.dataTxt],template:b?.templateTxt,copy:b?.copy};if(d.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!M(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(w=>{w==="PDF"?z({pdfSetting:c,date:o,data:d,type:a,columns:i,grouping:m,title:n,footerSetting:$}):w==="TXT"?A(E,b?.titleTxt||""):w==="EXCEL"?L({date:o,data:d,type:a,columns:i,grouping:m,excelSetting:g,title:n,footerSetting:$}):(L({date:o,data:d,type:a,columns:i,grouping:m,excelSetting:g,title:n}),z({pdfSetting:c,date:o,data:d,type:a,columns:i,grouping:m,title:n}),A(E,b?.titleTxt||""))})};export{bt as ExportData};
//# sourceMappingURL=index.mjs.map