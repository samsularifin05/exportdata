var z=["EXCEL","PDF","TXT","ALL"];function x(s){let p=new Date(s),b=p.getFullYear(),o=String(p.getMonth()+1).padStart(2,"0"),a=String(p.getDate()).padStart(2,"0"),m=String(p.getHours()).padStart(2,"0"),f=String(p.getMinutes()).padStart(2,"0"),d=String(p.getSeconds()).padStart(2,"0");return`${a}-${o}-${b} ${m}:${f}:${d}`}function M(s){return s.every(p=>z.includes(p))}import B from"exceljs";var _=async({columns:s,data:p,grouping:b,date:o,excelSetting:a,title:m,footerSetting:f})=>{let d=new B.Workbook;s=s.filter(r=>!r.options?.disabledColumn);let i=d.addWorksheet(m||a?.titleExcel),w=s.length,k=i.addRow([]);if(k.getCell(1).value=m||a?.titleExcel,k.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${k.number}:${String.fromCharCode(64+w)}${k.number}`),k.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),o){let r=i.addRow([]);r.getCell(1).value=`${o.caption?o.caption:"Tanggal "} : ${o?.start_date} ${o?.end_date?`s/d ${o?.end_date}`:""}`,r.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${r.number}:${String.fromCharCode(64+w)}${r.number}`),r.eachCell(t=>{t.font={color:{argb:"00000"},bold:!0,size:12}})}let G=i.addRow([]);G.getCell(1).value=a?.additionalTextHeader||"",G.getCell(1).alignment={horizontal:"center"},i.mergeCells(`A${G.number}:${String.fromCharCode(64+w)}${G.number}`),G.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),i.addRow(s).eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0};let t=r.value;r.value&&(r.alignment={horizontal:`${t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}`},r.value=t.label)});let R={};p.forEach(r=>{if(b.length>0){let t=b.map(l=>({value:r[l]!==void 0?`${S(l)} : `+r[l]:""}));i.addRow(t.map(l=>l.value));let C={};r.detail.forEach(l=>{let h=s.map(c=>{let n=c?.options?.format==="DATETIME"?x(l[c.key]):l[c.key],u={horizontal:c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"||c?.options?.format==="NUMBER"?"right":"left"},g=c.key;return R[g]=(R[g]||0)+Number(n),C[g]=(C[g]||0)+Number(n),{value:n,alignment:u,numFmt:c?.options?.format==="RP"?"#,##0":c?.options?.format==="GR"?"#,##0.000":void 0}}),E=i.addRow(h.map(c=>c.value));h.forEach((c,n)=>{let u=E.getCell(n+1);u.alignment=c.alignment,c.numFmt&&(u.numFmt=c.numFmt)})});let e=i.addRow(s.map(()=>null));s.forEach((l,h)=>{if(l?.options?.format==="RP"||l?.options?.format==="GR"||l?.options?.format==="NUMBER"){let c=p.length+4-1,n=`SUM(${String.fromCharCode(65+h)}4:${String.fromCharCode(65+h)}${c})`,u=e.getCell(h+1),g=f?.subTotal?.enableCount&&b.length>0?" : "+r.detail.length:"",F=f?.subTotal?.captionItem?f?.subTotal?.captionItem:"";e.getCell(1).value=`${f?.subTotal?.caption||"SUB TOTAL"} ${g} ${F}`,e.getCell(1).alignment={horizontal:"center"},u.numFmt=l?.options?.format==="GR"?"#,##0.000":"#,##0",u.value={formula:n},e.getCell(h+1).value=l?.options.disabledFooter?"":C[l.key]}else e.getCell(h+1).value=""}),a?.grandTotalSetting?.colSpan&&i.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},l.font={color:{argb:a?.txtColor},bold:!0}})}else{let t=s.map(e=>{let l=e?.options?.format==="DATETIME"?x(r[e.key]):r[e.key],h={vertical:"middle",horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"?"right":"left"},E=e.key;return R[E]=(R[E]||0)+Number(l),{value:l,options:e?.options,alignment:h,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),C=i.addRow(t.map(e=>e.value));t.forEach((e,l)=>{let h=C.getCell(l+1),E=e.alignment.vertical?String(e.alignment.vertical||"bottom"):"bottom",c="";(E==="middle"||E==="bottom"||E==="justify"||E==="distributed"||E==="top")&&(c=E),h.alignment={horizontal:e.alignment.horizontal,vertical:c},e.numFmt&&(h.numFmt=e.numFmt)})}});let y=i.addRow(s.map(()=>null));s.forEach((r,t)=>{if(r?.options?.format==="RP"||r?.options?.format==="GR"||r?.options?.format==="NUMBER"){let e=p.length+4-1,l=`SUM(${String.fromCharCode(65+t)}4:${String.fromCharCode(65+t)}${e})`,h=y.getCell(t+1),E=f?.grandTotal?.enableCount?b.length>0?" : "+p.map(n=>n.detail.length).reduce((n,u)=>n+u,0):" : "+p.length:"",c=f?.grandTotal?.captionItem?f?.grandTotal?.captionItem:"";y.getCell(1).value=`
      ${f?.grandTotal?.caption||"GRAND TOTAL"} ${E} ${c}`,y.getCell(1).alignment={horizontal:"center"},h.numFmt=r?.options?.format==="GR"?"#,##0.000":"#,##0",h.value={formula:l},y.getCell(t+1).value=r?.options.disabledFooter?"":R[r.key]}else y.getCell(t+1).value=""}),a?.grandTotalSetting?.colSpan&&i.mergeCells(`A${y.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${y.number}`),y.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0}});let D=await d.xlsx.writeBuffer(),T=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),$=document.createElement("a");$.href=URL.createObjectURL(T),$.download=`${m||a?.titleExcel}.xlsx`,document.body.appendChild($),$.click(),document.body.removeChild($)},L=_,S=s=>s.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");import j from"jspdf";import O from"jspdf-autotable";var H=({columns:s,data:p,grouping:b,pdfSetting:o,date:a,title:m,footerSetting:f})=>{let d=new j(o?.orientation,o?.unit,[o?.width||297,o?.height||210]),i=[],w=a?30:20;s=s.filter(t=>!t.options?.disabledColumn),d.setFontSize(10);let k=d.internal.pageSize.getWidth(),G=d.splitTextToSize(o?.textHeaderLeft||"",110);d.text(G,15,18),d.text(`${m||o?.titlePdf}`,k-15,18,{align:"right"}),a&&d.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,k-15,22,{align:"right"}),d.setProperties({title:m||o?.titlePdf});let N=s.map(t=>({content:t.label,key:t.key,options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left"}}));i.push(N);let R={};p.forEach(t=>{if(b.length>0){let C=b.map(n=>({content:t[n]!==void 0?`${X(n)} : `+t[n]:""}));i.push(C);let e={};t.detail.forEach(n=>{let u=s.map(g=>{let F=n[g.key],I=g.key;return R[I]=(R[I]||0)+Number(F),e[I]=(e[I]||0)+Number(F),{content:(()=>{switch(g?.options?.format){case"RP":return n[g.key]!==void 0?Number(n[g.key]||0).toLocaleString("kr-ko"):"";case"GR":return n[g.key]!==void 0?Number(n[g.key]||0).toFixed(3):"";case"NUMBER":return n[g.key]!==void 0?Number(n[g.key]||0):"";case"DATETIME":return n[g.key]!==void 0?x(n[g.key]||new Date):"";default:return n[g.key]!==void 0?n[g.key].toString():""}})(),styles:{halign:g?.options?.halign?g?.options?.halign:g?.options?.format==="RP"||g?.options?.format==="GR"||g?.options?.format==="NUMBER"||typeof n[g.key]=="number"?"right":"left"}}});i.push(u)});let l=[];s.forEach(n=>{let u=e[n.key];if(n?.options?.format==="RP"||n?.options?.format==="GR"||n?.options?.format==="NUMBER"){let g={content:n?.options?.disabledFooter?"":(()=>{switch(n?.options?.format){case"RP":return u.toLocaleString("kr-ko");case"GR":return u.toFixed(3);case"NUMBER":return u;default:return u.toString()}})(),styles:{halign:n?.options?.halign?n?.options?.halign:n?.options?.format==="RP"||n?.options?.format==="GR"||n?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};l.push(g)}else l.push({content:"",styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let h=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0,E=f?.subTotal?.enableCount&&b.length>0?" : "+t.detail.length:"",c=f?.subTotal?.captionItem?f?.subTotal?.captionItem:"";l[0]={content:`${f?.subTotal?.caption||"SUB TOTAL"} ${E} ${c}`,colSpan:h,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&l.splice(1,o?.grandTotalSetting?.colSpan),i.push(l)}else{let C=s.map(e=>{let l=t[e.key],h=e.key;return R[h]=(R[h]||0)+Number(l),{options:e?.options,content:(()=>{switch(e?.options?.format){case"RP":return t[e.key]!==void 0?Number(t[e.key]||0).toLocaleString("kr-ko"):"";case"GR":return t[e.key]!==void 0?Number(t[e.key]||0).toFixed(3):"";case"NUMBER":return t[e.key]!==void 0?Number(t[e.key]||0):"";case"DATETIME":return t[e.key]!==void 0?x(t[e.key]||new Date):"";default:return t[e.key]!==void 0?t[e.key].toString():""}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||e?.options?.format==="NUMBER"||typeof t[e.key]=="number"?"right":"left"}}});i.push(C)}});let y=[];s.forEach(t=>{let C=R[t.key];if(t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"){let e={options:t?.options,content:t?.options?.disabledFooter?"":(()=>{switch(t?.options?.format){case"RP":return C.toLocaleString("kr-ko");case"GR":return C.toFixed(3);case"NUMBER":return C;default:return C.toString()}})(),styles:{halign:t?.options?.halign?t?.options?.halign:t?.options?.format==="RP"||t?.options?.format==="GR"||t?.options?.format==="NUMBER"?"right":"left",textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};y.push(e)}else y.push({content:"",options:t?.options,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let D=o?.grandTotalSetting?.colSpan?Number(o?.grandTotalSetting?.colSpan||0)+1:0;if(!o?.grandTotalSetting?.disableGrandTotal){let t=f?.grandTotal?.enableCount?b.length>0?" : "+p.map(e=>e.detail.length).reduce((e,l)=>e+l,0):" : "+p.length:"",C=f?.grandTotal?.captionItem?f?.grandTotal?.captionItem:"";y[0]={content:`${f?.grandTotal?.caption||"GRAND TOTAL"} ${t} ${C}`,colSpan:D,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},o?.grandTotalSetting?.colSpan&&y.splice(1,o?.grandTotalSetting?.colSpan),i.push(y)}i.push([{content:`Print Date : ${x(`${new Date}`)}`,colSpan:s.length,styles:{textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),O(d,{head:[],body:i,startY:w,theme:o?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:o?.fontSIze||8},headStyles:{fontSize:o?.fontSIze||8,textColor:`#${o?.txtColor||"000"}`,fillColor:`#${o?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),i=[],w=d.lastAutoTable.finalY;let T=d.internal.getNumberOfPages(),$=d.internal.pageSize.width,r=d.internal.pageSize.height;d.setFontSize(10);for(let t=1;t<T+1;t++){let C=$/2,e=r-10;d.setPage(t),d.text(`${t} of ${T}`,C,e,{align:"center"})}if(o?.openNewTab){let t=d.output("bloburl");window.open(t)}else d.save(`${m||o?.titlePdf}.pdf`)},X=s=>s.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "),A=H;var K=s=>{let p=[],b=s.copy?2:1;for(let o=0;o<b;o++){let a=s.data.map(m=>{let f=s.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(f);)f=f.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(d,i,w)=>{let k=w.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(m[i])?m[i]:[m[i]]).reduce((R,y)=>R+k.replace(/\{([a-z0-9_]+)\}/gm,D=>{let T=D.replace(/(\{|\})/g,"");if(T.match(/nama_barang/)){let $=T.match(/nama_barang/),r=T==="nama_barang2"?[20,40]:T==="nama_barang3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}if(T.match(/deskripsi_jual/)){let $=T.match(/deskripsi_jual/),r=T==="deskripsi_jual2"?[20,40]:T==="deskripsi_jual3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}if(T.match(/deskripsi/)){let $=T.match(/deskripsi/),r=T==="deskripsi2"?[20,40]:T==="deskripsi3"?[40,60]:[0,20];return y[$]?.slice(...r).trim()||""}return y[T]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return f.replace(/\{([a-z0-9_]+)\}/gm,d=>{let i=d.replace(/(\{|\})/g,"");return i.match(/auto_cut/)?`
VA`:m[i]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let m in a)a[m]+=`

`;p.push(...a)}return p},W=async(s,p)=>{let b=K(s),o=new Blob([b?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=p,document.body.appendChild(a),a.click(),document.body.removeChild(a)},U=W;var mt=({columns:s,data:p,grouping:b,date:o,type:a,txtSetting:m,pdfSetting:f,excelSetting:d,title:i,footerSetting:w})=>{let k={data:[m?.dataTxt],template:m?.templateTxt,copy:m?.copy};if(p.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!M(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(G=>{G==="PDF"?A({pdfSetting:f,date:o,data:p,type:a,columns:s,grouping:b,title:i,footerSetting:w}):G==="TXT"?U(k,m?.titleTxt||""):G==="EXCEL"?L({date:o,data:p,type:a,columns:s,grouping:b,excelSetting:d,title:i,footerSetting:w}):(L({date:o,data:p,type:a,columns:s,grouping:b,excelSetting:d,title:i}),A({pdfSetting:f,date:o,data:p,type:a,columns:s,grouping:b,title:i}),U(k,m?.titleTxt||""))})};export{mt as ExportData};
//# sourceMappingURL=index.mjs.map