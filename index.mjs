import z from"bwip-js/browser";function G(i){let m=new Date(i),c=m.getFullYear(),t=String(m.getMonth()+1).padStart(2,"0"),r=String(m.getDate()).padStart(2,"0"),h=String(m.getHours()).padStart(2,"0"),p=String(m.getMinutes()).padStart(2,"0"),n=String(m.getSeconds()).padStart(2,"0");return`${r}-${t}-${c} ${h}:${p}:${n}`}import A from"exceljs";var _=async({columns:i,data:m,grouping:c,date:t,excelSetting:r,title:h})=>{let p=new A.Workbook;i=i.filter(a=>!a.options?.disabledColumn);let n=p.addWorksheet(h||r?.titleExcel),u=i.length,k=n.addRow([]);if(k.getCell(1).value=h||r?.titleExcel,k.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${k.number}:${String.fromCharCode(64+u)}${k.number}`),k.eachCell(a=>{a.font={color:{argb:"000000"},bold:!0,size:12}}),t){let a=n.addRow([]);a.getCell(1).value=`Tanggal : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,a.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${a.number}:${String.fromCharCode(64+u)}${a.number}`),a.eachCell(e=>{e.font={color:{argb:"00000"},bold:!0,size:12}})}let R=n.addRow([]);R.getCell(1).value=r?.additionalTextHeader||"",R.getCell(1).alignment={horizontal:"center"},n.mergeCells(`A${R.number}:${String.fromCharCode(64+u)}${R.number}`),R.eachCell(a=>{a.font={color:{argb:"000000"},bold:!0,size:12}}),n.addRow(i).eachCell(a=>{a.fill={type:"pattern",pattern:"solid",fgColor:{argb:r?.bgColor||"#E8E5E5"},bgColor:{argb:r?.bgColor||"#E8E5E5"}},a.font={color:{argb:r?.txtColor},bold:!0};let e=a.value;a.value&&(a.alignment={horizontal:`${e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"?"right":"left"}`},a.value=e.label)});let E={};m.forEach(a=>{if(c.length>0){let e=c.map(l=>({value:a[l]!==void 0?`${N(l)} : `+a[l]:""}));n.addRow(e.map(l=>l.value));let C={};a.detail.forEach(l=>{let f=i.map(g=>{let d=g?.options?.format==="DATETIME"?G(l[g.key]):l[g.key],w={horizontal:g?.options?.halign?g?.options?.halign:g?.options?.format==="RP"||g?.options?.format==="GR"?"right":"left"},x=g.key;return E[x]=(E[x]||0)+Number(d),C[x]=(C[x]||0)+Number(d),{value:d,alignment:w,numFmt:g?.options?.format==="RP"?"#,##0":g?.options?.format==="GR"?"#,##0.000":void 0}}),s=n.addRow(f.map(g=>g.value));f.forEach((g,d)=>{let w=s.getCell(d+1);w.alignment=g.alignment,g.numFmt&&(w.numFmt=g.numFmt)})});let o=n.addRow(i.map(()=>null));i.forEach((l,f)=>{if(l?.options?.format==="RP"||l?.options?.format==="GR"){let g=m.length+4-1,d=`SUM(${String.fromCharCode(65+f)}4:${String.fromCharCode(65+f)}${g})`,w=o.getCell(f+1);o.getCell(1).value="SUB TOTAL",o.getCell(1).alignment={horizontal:"center"},w.numFmt=l?.options?.format==="GR"?"#,##0.000":"#,##0",w.value={formula:d},o.getCell(f+1).value=l?.options.disabledFooter?"":C[l.key]}else o.getCell(f+1).value=""}),r?.grandTotalSetting?.colSpan&&n.mergeCells(`A${o.number}:${String.fromCharCode(64+Number(r?.grandTotalSetting?.colSpan))}${o.number}`),o.eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:r?.bgColor||"#E8E5E5"},bgColor:{argb:r?.bgColor||"#E8E5E5"}},l.font={color:{argb:r?.txtColor},bold:!0}})}else{let e=i.map(o=>{let l=o?.options?.format==="DATETIME"?G(a[o.key]):a[o.key],f={vertical:"middle",horizontal:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left"},s=o.key;return E[s]=(E[s]||0)+Number(l),{value:l,options:o?.options,alignment:f,numFmt:o?.options?.format==="RP"?"#,##0":o?.options?.format==="GR"?"#,##0.000":o?.options?.barcodeOption!==void 0?"BARCODE":void 0}}),C=n.addRow(e.map(o=>o.value));e.forEach((o,l)=>{let f=C.getCell(l+1),s=o.options?.barcodeOption;if(s!==void 0){let w=document.createElement("canvas");z.toCanvas(w,{bcid:s.format||"code128",text:String(o.value),scale:3,height:10,includetext:s.showText||!0,textxalign:"center"});let x=f.workbook.addImage({base64:w.toDataURL("image/png"),extension:"png"});C.height=s.heightColumn||39;let L=n.getColumn(l+1);return L.width=s.widthColumn||12,n.addImage(x,{tl:{col:l+1-1,row:Number(f.row||0)-1},ext:{width:s.widthBarcode||100,height:s.heightBarcode||50}}),f.alignment={horizontal:"center"},f.value="",null}let g=o.alignment.vertical?String(o.alignment.vertical||"bottom"):"bottom",d="";(g==="middle"||g==="bottom"||g==="justify"||g==="distributed"||g==="top")&&(d=g),f.alignment={horizontal:o.alignment.horizontal,vertical:d},o.numFmt&&(f.numFmt=o.numFmt)})}});let b=n.addRow(i.map(()=>null));i.forEach((a,e)=>{if(a?.options?.format==="RP"||a?.options?.format==="GR"){let o=m.length+4-1,l=`SUM(${String.fromCharCode(65+e)}4:${String.fromCharCode(65+e)}${o})`,f=b.getCell(e+1);b.getCell(1).value="GRAND TOTAL",b.getCell(1).alignment={horizontal:"center"},f.numFmt=a?.options?.format==="GR"?"#,##0.000":"#,##0",f.value={formula:l},b.getCell(e+1).value=a?.options.disabledFooter?"":E[a.key]}else b.getCell(e+1).value=""}),r?.grandTotalSetting?.colSpan&&n.mergeCells(`A${b.number}:${String.fromCharCode(64+Number(r?.grandTotalSetting?.colSpan))}${b.number}`),b.eachCell(a=>{a.fill={type:"pattern",pattern:"solid",fgColor:{argb:r?.bgColor||"#E8E5E5"},bgColor:{argb:r?.bgColor||"#E8E5E5"}},a.font={color:{argb:r?.txtColor},bold:!0}});let $=await p.xlsx.writeBuffer(),y=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),T=document.createElement("a");T.href=URL.createObjectURL(y),T.download=`${h||r?.titleExcel}.xlsx`,document.body.appendChild(T),T.click(),document.body.removeChild(T)},I=_,N=i=>i.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");import O from"jspdf";import j from"jspdf-autotable";var B=({columns:i,data:m,grouping:c,pdfSetting:t,date:r,title:h})=>{let p=new O(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),n=[],u=r?30:20;i=i.filter(e=>!e.options?.disabledColumn),p.setFontSize(10);let k=p.internal.pageSize.getWidth(),R=p.splitTextToSize(t?.textHeaderLeft||"",110);p.text(R,15,18),p.text(`${h||t?.titlePdf}`,k-15,18,{align:"right"}),r&&p.text(`Tanggal : ${r?.start_date} ${r?.end_date?`s/d ${r?.end_date}`:""}`,k-15,22,{align:"right"}),p.setProperties({title:h||t?.titlePdf});let P=i.map(e=>({content:e.label,key:e.key,options:e?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"?"right":"left"}}));n.push(P);let E={};m.forEach(e=>{if(c.length>0){let C=c.map(s=>({content:e[s]!==void 0?`${U(s)} : `+e[s]:""}));n.push(C);let o={};e.detail.forEach(s=>{let g=i.map(d=>{let w=s[d.key],x=d.key;return E[x]=(E[x]||0)+Number(w),o[x]=(o[x]||0)+Number(w),{content:(()=>{switch(d?.options?.format){case"RP":return s[d.key]!==void 0?Number(s[d.key]||0).toLocaleString("kr-ko"):"";case"GR":return s[d.key]!==void 0?Number(s[d.key]||0).toFixed(3):"";case"DATETIME":return s[d.key]!==void 0?G(s[d.key]||new Date):"";default:return s[d.key]!==void 0?s[d.key].toString():""}})(),styles:{halign:d?.options?.halign?d?.options?.halign:d?.options?.format==="RP"||d?.options?.format==="GR"||typeof s[d.key]=="number"?"right":"left"}}});n.push(g)});let l=[];i.forEach(s=>{let g=o[s.key];if(s?.options?.format==="RP"||s?.options?.format==="GR"){let d={content:s?.options?.disabledFooter?"":(()=>{switch(s?.options?.format){case"RP":return g.toLocaleString("kr-ko");case"GR":return g.toFixed(3);default:return g.toString()}})(),styles:{halign:s?.options?.halign?s?.options?.halign:s?.options?.format==="RP"||s?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};l.push(d)}else l.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let f=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0;l[0]={content:"SUB TOTAL",colSpan:f,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&l.splice(1,t?.grandTotalSetting?.colSpan),n.push(l)}else{let C=i.map(o=>{let l=e[o.key],f=o.key;return E[f]=(E[f]||0)+Number(l),{options:o?.options,content:(()=>{switch(o?.options?.format){case"RP":return e[o.key]!==void 0?Number(e[o.key]||0).toLocaleString("kr-ko"):"";case"GR":return e[o.key]!==void 0?Number(e[o.key]||0).toFixed(3):"";case"DATETIME":return e[o.key]!==void 0?G(e[o.key]||new Date):"";default:return e[o.key]!==void 0?e[o.key].toString():""}})(),styles:{halign:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"||typeof e[o.key]=="number"?"right":"left"}}});n.push(C)}});let b=[];i.forEach(e=>{let C=E[e.key];if(e?.options?.format==="RP"||e?.options?.format==="GR"){let o={options:e?.options,content:e?.options?.disabledFooter?"":(()=>{switch(e?.options?.format){case"RP":return C.toLocaleString("kr-ko");case"GR":return C.toFixed(3);default:return C.toString()}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};b.push(o)}else b.push({content:"",options:e?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let $=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0;t?.grandTotalSetting?.disableGrandTotal||(b[0]={content:"GRAND TOTAL",colSpan:$,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&b.splice(1,t?.grandTotalSetting?.colSpan),n.push(b)),n.push([{content:`Print Date : ${G(`${new Date}`)}`,colSpan:i.length,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),j(p,{head:[],body:n,startY:u,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),n=[],u=p.lastAutoTable.finalY;let y=p.internal.getNumberOfPages(),T=p.internal.pageSize.width,a=p.internal.pageSize.height;p.setFontSize(10);for(let e=1;e<y+1;e++){let C=T/2,o=a-10;p.setPage(e),p.text(`${e} of ${y}`,C,o,{align:"center"})}if(t?.openNewTab){let e=p.output("bloburl");window.open(e)}else p.save(`${h||t?.titlePdf}.pdf`)},U=i=>i.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),S=B;var H=i=>{let m=[];for(let c=0;c<1;c++){let t=i.data.map(r=>{let h=i.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(h);)h=h.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(p,n,u)=>{let k=u.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(r[n])?r[n]:[r[n]]).reduce((E,b)=>E+k.replace(/\{([a-z0-9_]+)\}/gm,$=>{let y=$.replace(/(\{|\})/g,"");if(y.match(/nama_barang/)){let T=y.match(/nama_barang/),a=y==="nama_barang2"?[20,40]:y==="nama_barang3"?[40,60]:[0,20];return b[T]?.slice(...a).trim()||""}if(y.match(/deskripsi_jual/)){let T=y.match(/deskripsi_jual/),a=y==="deskripsi_jual2"?[20,40]:y==="deskripsi_jual3"?[40,60]:[0,20];return b[T]?.slice(...a).trim()||""}if(y.match(/deskripsi/)){let T=y.match(/deskripsi/),a=y==="deskripsi2"?[20,40]:y==="deskripsi3"?[40,60]:[0,20];return b[T]?.slice(...a).trim()||""}return b[y]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return h.replace(/\{([a-z0-9_]+)\}/gm,p=>{let n=p.replace(/(\{|\})/g,"");return n==="intenal_external"?c===0?"Pelanggan":"Internal":n.match(/auto_cut/)?`
VA`:r[n]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail_barang\)/g,"").replace(/[}{]/g,"")});for(let r in t)t[r]+=`

`;m.push(...t)}return m},M=async(i,m)=>{let c=H(i),t=new Blob([c?.join(`
`)||""],{type:"text/plain"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=m,document.body.appendChild(r),r.click(),document.body.removeChild(r)},F=M;var gt=({columns:i,data:m,grouping:c,date:t,type:r,txtSetting:h,pdfSetting:p,excelSetting:n,title:u})=>{let k={data:h?.dataTxt?.length?h?.dataTxt:[h?.dataTxt],template:h?.templateTxt};r.forEach(R=>{R==="PDF"?S({pdfSetting:p,date:t,data:m,type:r,columns:i,grouping:c,title:u}):R==="TXT"?F(k,h?.titleTxt||""):R==="EXCEL"?I({date:t,data:m,type:r,columns:i,grouping:c,excelSetting:n,title:u}):(I({date:t,data:m,type:r,columns:i,grouping:c,excelSetting:n,title:u}),S({pdfSetting:p,date:t,data:m,type:r,columns:i,grouping:c,title:u}),F(k,h?.titleTxt||""))})};export{gt as ExportData};
//# sourceMappingURL=index.mjs.map