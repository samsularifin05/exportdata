var _=["EXCEL","PDF","TXT","ALL"];function x(n){let p=new Date(n),m=p.getFullYear(),t=String(p.getMonth()+1).padStart(2,"0"),a=String(p.getDate()).padStart(2,"0"),b=String(p.getHours()).padStart(2,"0"),d=String(p.getMinutes()).padStart(2,"0"),g=String(p.getSeconds()).padStart(2,"0");return`${a}-${t}-${m} ${b}:${d}:${g}`}function S(n){return n.every(p=>_.includes(p))}import j from"exceljs";var O=async({columns:n,data:p,grouping:m,date:t,excelSetting:a,title:b,footerSetting:d})=>{let g=new j.Workbook;n=n.filter(r=>!r.options?.disabledColumn);let s=g.addWorksheet(b||a?.titleExcel),w=n.length,k=s.addRow([]);if(k.getCell(1).value=b||a?.titleExcel,k.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${k.number}:${String.fromCharCode(64+w)}${k.number}`),k.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),t){let r=s.addRow([]);r.getCell(1).value=`${t.caption?t.caption:"Tanggal "} : ${t?.start_date} ${t?.end_date?`s/d ${t?.end_date}`:""}`,r.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${r.number}:${String.fromCharCode(64+w)}${r.number}`),r.eachCell(o=>{o.font={color:{argb:"00000"},bold:!0,size:12}})}let R=s.addRow([]);R.getCell(1).value=a?.additionalTextHeader||"",R.getCell(1).alignment={horizontal:"center"},s.mergeCells(`A${R.number}:${String.fromCharCode(64+w)}${R.number}`),R.eachCell(r=>{r.font={color:{argb:"000000"},bold:!0,size:12}}),s.addRow(n).eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0};let o=r.value;r.value&&(r.alignment={horizontal:`${o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left"}`},r.value=o.label)});let $={};p.forEach(r=>{if(m.length>0){let o=m.map(i=>({value:r[i]!==void 0?`${U(i)} : `+r[i]:""}));s.addRow(o.map(i=>i.value));let T={};r.detail.forEach(i=>{let h=n.map(c=>{let l=c?.options?.format==="DATETIME"?x(i[c.key]):i[c.key],E={horizontal:c?.options?.halign?c?.options?.halign:c?.options?.format==="RP"||c?.options?.format==="GR"?"right":"left"},f=c.key;return $[f]=($[f]||0)+Number(l),T[f]=(T[f]||0)+Number(l),{value:l,alignment:E,numFmt:c?.options?.format==="RP"?"#,##0":c?.options?.format==="GR"?"#,##0.000":void 0}}),u=s.addRow(h.map(c=>c.value));h.forEach((c,l)=>{let E=u.getCell(l+1);E.alignment=c.alignment,c.numFmt&&(E.numFmt=c.numFmt)})});let e=s.addRow(n.map(()=>null));n.forEach((i,h)=>{if(i?.options?.format==="RP"||i?.options?.format==="GR"){let c=p.length+4-1,l=`SUM(${String.fromCharCode(65+h)}4:${String.fromCharCode(65+h)}${c})`,E=e.getCell(h+1),f=d?.subTotal?.enableCount&&m.length>0?" : "+r.detail.length:"",F=d?.subTotal?.captionItem?d?.subTotal?.captionItem:"";e.getCell(1).value=`${d?.subTotal?.caption||"SUB TOTAL"} ${f} ${F}`,e.getCell(1).alignment={horizontal:"center"},E.numFmt=i?.options?.format==="GR"?"#,##0.000":"#,##0",E.value={formula:l},e.getCell(h+1).value=i?.options.disabledFooter?"":T[i.key]}else e.getCell(h+1).value=""}),a?.grandTotalSetting?.colSpan&&s.mergeCells(`A${e.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${e.number}`),e.eachCell(i=>{i.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},i.font={color:{argb:a?.txtColor},bold:!0}})}else{let o=n.map(e=>{let i=e?.options?.format==="DATETIME"?x(r[e.key]):r[e.key],h={vertical:"middle",horizontal:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"?"right":"left"},u=e.key;return $[u]=($[u]||0)+Number(i),{value:i,options:e?.options,alignment:h,numFmt:e?.options?.format==="RP"?"#,##0":e?.options?.format==="GR"?"#,##0.000":void 0}}),T=s.addRow(o.map(e=>e.value));o.forEach((e,i)=>{let h=T.getCell(i+1),u=e.alignment.vertical?String(e.alignment.vertical||"bottom"):"bottom",c="";(u==="middle"||u==="bottom"||u==="justify"||u==="distributed"||u==="top")&&(c=u),h.alignment={horizontal:e.alignment.horizontal,vertical:c},e.numFmt&&(h.numFmt=e.numFmt)})}});let y=s.addRow(n.map(()=>null));n.forEach((r,o)=>{if(r?.options?.format==="RP"||r?.options?.format==="GR"){let e=p.length+4-1,i=`SUM(${String.fromCharCode(65+o)}4:${String.fromCharCode(65+o)}${e})`,h=y.getCell(o+1),u=d?.grandTotal?.enableCount?m.length>0?" : "+p.map(l=>l.detail.length).reduce((l,E)=>l+E,0):" : "+p.length:"",c=d?.grandTotal?.captionItem?d?.grandTotal?.captionItem:"";y.getCell(1).value=`${d?.grandTotal?.caption||"GRAND TOTAL"} ${u} ${c}`,y.getCell(1).alignment={horizontal:"center"},h.numFmt=r?.options?.format==="GR"?"#,##0.000":"#,##0",h.value={formula:i},y.getCell(o+1).value=r?.options.disabledFooter?"":$[r.key]}else y.getCell(o+1).value=""}),a?.grandTotalSetting?.colSpan&&s.mergeCells(`A${y.number}:${String.fromCharCode(64+Number(a?.grandTotalSetting?.colSpan))}${y.number}`),y.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:a?.bgColor||"#E8E5E5"},bgColor:{argb:a?.bgColor||"#E8E5E5"}},r.font={color:{argb:a?.txtColor},bold:!0}});let D=await g.xlsx.writeBuffer(),C=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=document.createElement("a");G.href=URL.createObjectURL(C),G.download=`${b||a?.titleExcel}.xlsx`,document.body.appendChild(G),G.click(),document.body.removeChild(G)},A=O,U=n=>n.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ");import H from"jspdf";import X from"jspdf-autotable";var M=({columns:n,data:p,grouping:m,pdfSetting:t,date:a,title:b,footerSetting:d})=>{let g=new H(t?.orientation,t?.unit,[t?.width||297,t?.height||210]),s=[],w=a?30:20;n=n.filter(o=>!o.options?.disabledColumn),g.setFontSize(10);let k=g.internal.pageSize.getWidth(),R=g.splitTextToSize(t?.textHeaderLeft||"",110);g.text(R,15,18),g.text(`${b||t?.titlePdf}`,k-15,18,{align:"right"}),a&&g.text(`${a.caption?a.caption:"TANGGAL "} : ${a?.start_date} ${a?.end_date?`s/d ${a?.end_date}`:""}`,k-15,22,{align:"right"}),g.setProperties({title:b||t?.titlePdf});let L=n.map(o=>({content:o.label,key:o.key,options:o?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left"}}));s.push(L);let $={};p.forEach(o=>{if(m.length>0){let T=m.map(l=>({content:o[l]!==void 0?`${B(l)} : `+o[l]:""}));s.push(T);let e={};o.detail.forEach(l=>{let E=n.map(f=>{let F=l[f.key],I=f.key;return $[I]=($[I]||0)+Number(F),e[I]=(e[I]||0)+Number(F),{content:(()=>{switch(f?.options?.format){case"RP":return l[f.key]!==void 0?Number(l[f.key]||0).toLocaleString("kr-ko"):"";case"GR":return l[f.key]!==void 0?Number(l[f.key]||0).toFixed(3):"";case"DATETIME":return l[f.key]!==void 0?x(l[f.key]||new Date):"";default:return l[f.key]!==void 0?l[f.key].toString():""}})(),styles:{halign:f?.options?.halign?f?.options?.halign:f?.options?.format==="RP"||f?.options?.format==="GR"||typeof l[f.key]=="number"?"right":"left"}}});s.push(E)});let i=[];n.forEach(l=>{let E=e[l.key];if(l?.options?.format==="RP"||l?.options?.format==="GR"){let f={content:l?.options?.disabledFooter?"":(()=>{switch(l?.options?.format){case"RP":return E.toLocaleString("kr-ko");case"GR":return E.toFixed(3);default:return E.toString()}})(),styles:{halign:l?.options?.halign?l?.options?.halign:l?.options?.format==="RP"||l?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};i.push(f)}else i.push({content:"",styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let h=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0,u=d?.subTotal?.enableCount&&m.length>0?" : "+o.detail.length:"",c=d?.subTotal?.captionItem?d?.subTotal?.captionItem:"";i[0]={content:`${d?.subTotal?.caption||"SUB TOTAL"} ${u} ${c}`,colSpan:h,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&i.splice(1,t?.grandTotalSetting?.colSpan),s.push(i)}else{let T=n.map(e=>{let i=o[e.key],h=e.key;return $[h]=($[h]||0)+Number(i),{options:e?.options,content:(()=>{switch(e?.options?.format){case"RP":return o[e.key]!==void 0?Number(o[e.key]||0).toLocaleString("kr-ko"):"";case"GR":return o[e.key]!==void 0?Number(o[e.key]||0).toFixed(3):"";case"DATETIME":return o[e.key]!==void 0?x(o[e.key]||new Date):"";default:return o[e.key]!==void 0?o[e.key].toString():""}})(),styles:{halign:e?.options?.halign?e?.options?.halign:e?.options?.format==="RP"||e?.options?.format==="GR"||typeof o[e.key]=="number"?"right":"left"}}});s.push(T)}});let y=[];n.forEach(o=>{let T=$[o.key];if(o?.options?.format==="RP"||o?.options?.format==="GR"){let e={options:o?.options,content:o?.options?.disabledFooter?"":(()=>{switch(o?.options?.format){case"RP":return T.toLocaleString("kr-ko");case"GR":return T.toFixed(3);default:return T.toString()}})(),styles:{halign:o?.options?.halign?o?.options?.halign:o?.options?.format==="RP"||o?.options?.format==="GR"?"right":"left",textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}};y.push(e)}else y.push({content:"",options:o?.options,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold"}})});let D=t?.grandTotalSetting?.colSpan?Number(t?.grandTotalSetting?.colSpan||0)+1:0;if(!t?.grandTotalSetting?.disableGrandTotal){let o=d?.grandTotal?.enableCount?m.length>0?" : "+p.map(e=>e.detail.length).reduce((e,i)=>e+i,0):" : "+p.length:"",T=d?.grandTotal?.captionItem?d?.grandTotal?.captionItem:"";y[0]={content:`${d?.grandTotal?.caption||"GRAND TOTAL"} ${o} ${T}`,colSpan:D,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"bold",halign:"center"}},t?.grandTotalSetting?.colSpan&&y.splice(1,t?.grandTotalSetting?.colSpan),s.push(y)}s.push([{content:`Print Date : ${x(`${new Date}`)}`,colSpan:n.length,styles:{textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`,fontStyle:"italic"}}]),X(g,{head:[],body:s,startY:w,theme:t?.theme||"plain",rowPageBreak:"avoid",margin:{top:10},bodyStyles:{fontSize:t?.fontSIze||8},headStyles:{fontSize:t?.fontSIze||8,textColor:`#${t?.txtColor||"000"}`,fillColor:`#${t?.bgColor||"E8E5E5"}`},tableLineColor:[255,255,255]}),s=[],w=g.lastAutoTable.finalY;let C=g.internal.getNumberOfPages(),G=g.internal.pageSize.width,r=g.internal.pageSize.height;g.setFontSize(10);for(let o=1;o<C+1;o++){let T=G/2,e=r-10;g.setPage(o),g.text(`${o} of ${C}`,T,e,{align:"center"})}if(t?.openNewTab){let o=g.output("bloburl");window.open(o)}else g.save(`${b||t?.titlePdf}.pdf`)},B=n=>n.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),z=M;var K=n=>{let p=[],m=n.copy?2:1;for(let t=0;t<m;t++){let a=n.data.map(b=>{let d=n.template;for(;/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/gm.exec(d);)d=d.replace(/\n!!LOOP\((.+)\)(\{\n(.*\n)+\})\n/,(g,s,w)=>{let k=w.replace(/^\{/,"").replace(/\}$/,"");return(Array.isArray(b[s])?b[s]:[b[s]]).reduce(($,y)=>$+k.replace(/\{([a-z0-9_]+)\}/gm,D=>{let C=D.replace(/(\{|\})/g,"");if(C.match(/nama_barang/)){let G=C.match(/nama_barang/),r=C==="nama_barang2"?[20,40]:C==="nama_barang3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}if(C.match(/deskripsi_jual/)){let G=C.match(/deskripsi_jual/),r=C==="deskripsi_jual2"?[20,40]:C==="deskripsi_jual3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}if(C.match(/deskripsi/)){let G=C.match(/deskripsi/),r=C==="deskripsi2"?[20,40]:C==="deskripsi3"?[40,60]:[0,20];return y[G]?.slice(...r).trim()||""}return y[C]||""}),"").replace(/\n(\s)+\n/gm,`
`)});return d.replace(/\{([a-z0-9_]+)\}/gm,g=>{let s=g.replace(/(\{|\})/g,"");return s.match(/auto_cut/)?`
VA`:b[s]||""}).replace(/\n(\s)+\n/gm,`
`).replace(/~new_line~/gm,`
`).replace(/!!LOOP\(detail\)/g,"").replace(/[}{]/g,"")});for(let b in a)a[b]+=`

`;p.push(...a)}return p},W=async(n,p)=>{let m=K(n),t=new Blob([m?.join(`
`)||""],{type:"text/plain"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=p,document.body.appendChild(a),a.click(),document.body.removeChild(a)},N=W;var bt=({columns:n,data:p,grouping:m,date:t,type:a,txtSetting:b,pdfSetting:d,excelSetting:g,title:s,footerSetting:w})=>{let k={data:[b?.dataTxt],template:b?.templateTxt,copy:b?.copy};if(p.length===0)throw new Error("Data is required");if(a.length===0)throw new Error("Type is required");if(!S(a))throw new Error('Type Export must use ["EXCEL", "PDF", "TXT", "ALL"]');a.forEach(R=>{R==="PDF"?z({pdfSetting:d,date:t,data:p,type:a,columns:n,grouping:m,title:s,footerSetting:w}):R==="TXT"?N(k,b?.titleTxt||""):R==="EXCEL"?A({date:t,data:p,type:a,columns:n,grouping:m,excelSetting:g,title:s,footerSetting:w}):(A({date:t,data:p,type:a,columns:n,grouping:m,excelSetting:g,title:s}),z({pdfSetting:d,date:t,data:p,type:a,columns:n,grouping:m,title:s}),N(k,b?.titleTxt||""))})};export{bt as ExportData};
//# sourceMappingURL=index.mjs.map